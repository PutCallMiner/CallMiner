{%- macro tab_button(idx, current, is_icon = false, text = "" , title = "") -%}
    <a href="?tab={{ idx }}"
       class="{{ "icon-button" if is_icon else "" }} {{ "active" if idx == current else "" }}"
       title="{{ title }}"
       hx-get="?tab={{ idx }}"
       hx-target="closest .tabs"
       hx-swap="innerHTML"
       hx-trigger="click">
        {%- if is_icon -%}
            <span class="icon">{{ text }}</span>
        {%- else -%}
            {{ text }}
        {%- endif -%}
    </a>
{%- endmacro -%}
{%- macro progress_circle(link, delay = 0, load = True) -%}
    {%- if load -%}
        <div class="progress"
             hx-get="{{ link }}"
             hx-target="this"
             hx-swap="outerHTML"
             hx-trigger="{{ "load delay:" ~ (delay * 10) ~ "s" }}">
            <svg viewBox="25 25 50 50">
                <circle r="20" cy="50" cx="50"></circle>
            </svg>
            <p>Analysis in progress...</p>
        </div>
    {%- else -%}
        {{ caller() }}
    {%- endif -%}
{%- endmacro -%}
{%- macro link(search = "", take = 20, skip = 0) -%}
    {%- if search != "" or take != 20 or skip != 0 -%}
        ?
    {%- endif -%}
    {%- if search != "" -%}
        search={{ search }}
    {%- endif -%}
    {%- if search != "" and take != 20 -%}
        &
    {%- endif -%}
    {%- if take != 20 -%}
        take={{ take }}
    {%- endif -%}
    {%- if (search != "" or take != 20) and skip != 0 -%}
        &
    {%- endif -%}
    {%- if skip != 0 -%}
        skip={{ skip }}
    {%- endif -%}
{%- endmacro -%}
{%- macro recording_url(value) -%}
    {{ value.split("/")[-1] .split(".")[0] }}
{%- endmacro -%}
{%- macro time_to_min(secs) -%}
    {{ "%02d:%02d"|format(secs // 60000, (secs // 1000) % 60)}}
{%- endmacro -%}
{%- macro ner(text, entries) -%}
    {% if entries|count == 0 %}
        {{ text }}
    {% else %}
        {%- for i in range(entries|count) -%}
            {%- set start_char = 0 if i == 0 else entries[i - 1].end_char -%}
            {{- text[start_char:entries[i].start_char] -}}
            <mark style="background-color: var(--ner-{{ entries[i].entity }});">{{- text[entries[i].start_char:entries[i].end_char] -}}</mark>
        {%- endfor -%}
        {{- text[entries[-1].end_char:] -}}
    {% endif %}
{%- endmacro -%}
{%- macro ner_details(entity, transcript_entries, ner_entries) -%}
    <details>
        <summary>
            <span>{{ entity[0] }}<span class="circle" style="background-color: var(--ner-{{ entity[1] }});"></span></span>
        </summary>
        <ul>
            {%- set seen = [] -%}
            {%- for i in range(transcript_entries|count) -%}
                {%- for entry in ner_entries[i] -%}
                    {%- set text = transcript_entries[i].text[entry.start_char:entry.end_char] -%}
                    {%- if entry.entity == entity[1] and text not in seen -%}
                        <li hx-get="#entry-{{ transcript_entries[i].start_time }}" hx-swap="none">{{ text }}</li>
                        {% do seen.append(text) %}
                    {%- endif -%}
                {%- endfor -%}
            {%- endfor -%}
        </ul>
    </details>
{%- endmacro -%}
